# 体彩风格竞猜功能实现说明
版本更新加v 1997835 注明世界杯
## 已完成功能

### 1. 数据库设计 ✅

#### 创建的新表：
- `h_play_spf` - 胜负平玩法表
  - 存储主胜、平局、客胜的赔率
  - 支持启用/禁用开关
  
- `h_play_bifen` - 比分玩法表
  - 存储具体比分及其赔率
  - 如：1:0, 2:1, 0:0 等常见比分
  
- `h_play_jinqiu` - 总进球数玩法表
  - 存储总进球数 0-7+ 的赔率
  - 每个进球数对应一个赔率
  
- `h_saishi_play_relation` - 赛事玩法关联表
  - 支持一场赛事关联多个玩法
  - 灵活控制哪些玩法可用

#### h_saishi 表新增字段：
- `enable_play_spf` - 启用胜负平玩法
- `spf_home_odds` - 主胜赔率
- `spf_draw_odds` - 平局赔率
- `spf_away_odds` - 客胜赔率
- `enable_play_jinqiu` - 启用总进球数玩法
- `jq_0` 到 `jq_7` - 0-7+球的赔率
- `enable_play_bifen` - 启用比分玩法
- `bifen_odds` - 比分赔率数据（文本格式）

### 2. 后台管理界面 ✅

#### 赛事编辑页面（saishi_edit.html）

新增"体彩玩法配置"区域，包含：

**1. 胜负平玩法配置**
- 复选框：启用/禁用
- 主胜赔率输入框
- 平局赔率输入框
- 客胜赔率输入框
- "从体彩官网采集赔率"按钮

**2. 总进球数玩法配置**
- 复选框：启用/禁用
- 0-7+球赔率输入表格
- "从体彩官网采集赔率"按钮

**3. 比分玩法配置**
- 复选框：启用/禁用
- 比分赔率输入框（支持多行格式）
- 格式：`1:0=3.50,2:1=4.20`
- "从体彩官网采集赔率"按钮

#### 数据采集功能
- `fetchSPF()` - 采集胜负平赔率
- `fetchJinqiu()` - 采集总进球数赔率
- `fetchBifen()` - 采集比分赔率
- 模拟体彩官网数据（实际需要对接真实API）

### 3. 后台控制器 ✅

#### AdminController.class.php 修改

在 `saishi_edit()` 方法的保存逻辑中添加：
- 处理胜负平玩法数据保存
- 处理总进球数玩法数据保存
- 处理比分玩法数据保存
- 自动转换checkbox值为0或1
- 自动处理空值

## 使用说明

### 后台操作流程

1. **进入赛事编辑页面**
   - 访问：`/Admin/saishi_edit?id=赛事ID`
   
2. **配置体彩玩法**
   - 在页面底部找到"体彩玩法配置"区域
   - 勾选要启用的玩法（可多选）
   
3. **设置赔率**
   - 方式1：手动输入赔率
   - 方式2：点击"从体彩官网采集赔率"按钮（当前为模拟数据）
   
4. **保存赛事**
   - 点击"提交"按钮
   - 所有配置数据自动保存到数据库

### 体彩玩法说明

#### 1. 胜负平玩法
- **选项**：主胜、平局、客胜
- **适用**：所有足球比赛
- **特点**：简单易懂，新手友好
- **示例**：主胜 2.35，平局 3.10，客胜 2.85

#### 2. 总进球数玩法
- **选项**：0球、1球、2球、3球、4球、5球、6球、7球+
- **适用**：所有足球比赛
- **特点**：不看胜负，只看总进球数
- **示例**：0球 8.50，1球 4.75，2球 3.60

#### 3. 比分玩法
- **选项**：具体比分（如 1:0, 2:1, 0:0, 1:1 等）
- **适用**：所有足球比赛
- **特点**：高赔率，难度大
- **示例**：1:0=7.00, 2:1=12.00, 0:0=8.50

## 数据格式说明

### 比分玩法数据格式
```
1:0=7.00,2:0=12.00,2:1=7.50,0:0=8.50
1:1=6.50,0:1=8.00,3:0=15.00,3:1=18.00
2:2=9.00,0:2=10.00,3:2=21.00
```

每行一个比分，格式：`比分=赔率`，用逗号分隔

## 待完成功能

### 1. 前端投注页面修改
需要修改用户投注页面，显示新的3种玩法：
- 显示玩法标签页或下拉选择
- 根据选择的玩法显示相应的赔率选项
- 支持投注金额输入

### 2. 投注逻辑处理
需要修改投注处理逻辑：
- 根据玩法类型验证投注
- 计算不同玩法的奖金
- 保存投注记录

### 3. 数据采集API对接
当前数据采集为模拟数据，需要：
- 对接体彩官网真实API
- 或编写爬虫获取实时赔率
- 定时更新赔率数据

## 文件清单

### 已创建/修改的文件
1. `/Users/wang/Desktop/1/tc_betting_tables.sql` - 数据库表结构
2. `/Users/wang/Desktop/1/add_tc_fields.sql` - 表字段添加SQL
3. `/Users/wang/Desktop/1/My/Home/View/Admin/saishi_edit.html` - 后台编辑页面
4. `/Users/wang/Desktop/1/My/Home/Controller/AdminController.class.php` - 后台控制器

### 数据库表
- `h_play_spf`
- `h_play_bifen`
- `h_play_jinqiu`
- `h_saishi_play_relation`
- `h_saishi` (新增字段)

## 测试建议

### 后端测试
1. 访问赛事编辑页面
2. 尝试启用不同玩法
3. 手动输入赔率
4. 测试采集按钮（模拟数据）
5. 保存并验证数据库

### 前端测试（待开发）
1. 查看赛事详情
2. 选择不同玩法
3. 尝试投注
4. 验证赔率计算

## 注意事项

1. **兼容性**：保留了原有的竞猜规则功能，不影响现有系统
2. **扩展性**：支持一场赛事同时启用多个玩法
3. **灵活性**：每个玩法可独立启用/禁用
4. **安全性**：所有数据都需要管理员权限

## 参考资料

- 体彩官网：https://m.sporttery.cn/mjc/jsq/zqspf/
- 数据库：MySQL
- 框架：ThinkPHP 3.2
- 前端：jQuery + Layer
